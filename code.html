<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>DrawPad â€” Copy Button Fixed</title>
<style>
html, body {
  margin:0;
  height:100%;
  width:100%;
  overflow:hidden;
  background:#000;
  font-family:system-ui;
}
canvas {
  display:block;
  width:100%;
  height:100%;
  touch-action:none;
  position:absolute;
  top:0;
  left:0;
  z-index:0;
}
#export {
  position:fixed;
  top:20px;
  right:20px;
  padding:10px 14px;
  background: rgba(18,30,60,0.36);
  color:#8fbfff;
  font-weight:700;
  border-radius:20px;
  cursor:pointer;
  z-index:10000;
  user-select:none;
}
</style>
</head>
<body>

<canvas id="draw"></canvas>
<div id="export">Copy Code</div>

<script>
const canvas = document.getElementById('draw');
const ctx = canvas.getContext('2d');
const exportBtn = document.getElementById('export');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let points = [];
let drawing = false;

// --- Drawing ---
function drawPoint(x, y){
  points.push({x, y});
  ctx.fillStyle = '#8fbfff';
  ctx.beginPath();
  ctx.arc(x, y, 4, 0, Math.PI*2);
  ctx.fill();
}

// --- Helper to check button tap ---
function isOnButton(x, y) {
  const rect = exportBtn.getBoundingClientRect();
  return x >= rect.left && x <= rect.right && y >= rect.top && y <= rect.bottom;
}

// --- Mouse events ---
canvas.addEventListener('mousedown', e => {
  if (!isOnButton(e.clientX, e.clientY)) drawing = true;
});
canvas.addEventListener('mouseup', () => drawing = false);
canvas.addEventListener('mousemove', e => {
  if(drawing && !isOnButton(e.clientX, e.clientY)) drawPoint(e.clientX, e.clientY);
});

// --- Touch events ---
canvas.addEventListener('touchstart', e => {
  const t = e.touches[0];
  if (!isOnButton(t.clientX, t.clientY)) {
    e.preventDefault();
    drawing = true;
    drawPoint(t.clientX, t.clientY);
  }
});
canvas.addEventListener('touchend', e => { drawing=false; });
canvas.addEventListener('touchmove', e => {
  const t = e.touches[0];
  if(drawing && !isOnButton(t.clientX, t.clientY)) {
    e.preventDefault();
    drawPoint(t.clientX, t.clientY);
  }
});

// --- Copy Code ---
function copyCode(){
  const codeLines = points.map(p => `ctx.fillRect(${p.x},${p.y},4,4);`);
  const fullCode = `const canvas = document.getElementById('draw');\nconst ctx = canvas.getContext('2d');\n` + codeLines.join('\n');

  // create a temporary textarea for guaranteed copy
  const textarea = document.createElement('textarea');
  textarea.value = fullCode;
  document.body.appendChild(textarea);
  textarea.select();
  textarea.setSelectionRange(0, textarea.value.length);

  try {
    document.execCommand('copy');
    exportBtn.textContent = "Copied!";
  } catch {
    exportBtn.textContent = "Failed!";
  }

  document.body.removeChild(textarea);
  setTimeout(()=>exportBtn.textContent="Copy Code",1000);
}

exportBtn.addEventListener('click', copyCode);
exportBtn.addEventListener('touchstart', e=>{
  e.preventDefault();
  e.stopPropagation();
  copyCode();
});

// --- Resize ---
window.addEventListener('resize', ()=>{
  const data = ctx.getImageData(0,0,canvas.width,canvas.height);
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  ctx.putImageData(data,0,0);
});
</script>
</body>
</html>
