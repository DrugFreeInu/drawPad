<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>DrawPad â€” Live</title>

<style>
  html, body {
    margin: 0;
    height: 100%;
    width: 100%;
    overflow: hidden;
    background: #000;
    font-family: system-ui;
  }

  iframe { 
    position: fixed;
    inset: 0;
    width: 100%;
    height: 100%;
    border: 0;
    pointer-events: none; /* let button clicks go through */
  }

  #copyBtn {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 10px 14px;
    background: rgba(18,30,60,0.36);
    color: #8fbfff;
    font-weight: 700;
    border-radius: 20px;
    cursor: pointer;
    z-index: 9999;
    user-select: none;
    transition: background 0.1s, color 0.1s;
  }

  #copyBtn:active {
    background: rgba(255,255,255,0.2);
    color: #fff;
  }
</style>
</head>
<body>

<!-- Just call the files directly -->
<iframe id="gridFrame" src="grid.html" style="z-index:0;"></iframe>
<iframe id="drawpadFrame" src="drawpad.html" style="z-index:1;"></iframe>
<div id="copyBtn">Copy Code</div>

<script>
const drawpad = document.getElementById('drawpadFrame');
const copyBtn = document.getElementById('copyBtn');

// Auto-cache drawpad to avoid stale content
drawpad.src = 'drawpad.html?v=' + Date.now();

// Copy code from drawpad points
copyBtn.addEventListener('click', async () => {
  const points = await new Promise(resolve => {
    const handler = e => {
      if(e.data?.type === 'sendPoints'){
        resolve(e.data.points);
        window.removeEventListener('message', handler);
      }
    };
    window.addEventListener('message', handler);
    drawpad.contentWindow.postMessage({ type: 'getPoints' }, '*');
  });

  if(!points) return;

  const codeLines = points.map(p => `ctx.fillRect(${p.x},${p.y},4,4);`);
  const fullCode = `const canvas = document.getElementById('draw');\nconst ctx = canvas.getContext('2d');\n` + codeLines.join('\n');

  try {
    await navigator.clipboard.writeText(fullCode);
    copyBtn.textContent = "Copied!";
  } catch {
    copyBtn.textContent = "Failed!";
  }

  setTimeout(() => copyBtn.textContent = "Copy Code", 1000);
});

// Visual touch feedback
copyBtn.addEventListener('touchstart', e => {
  e.preventDefault();
  e.stopPropagation();
  copyBtn.style.background = 'rgba(255,255,255,0.2)';
});
copyBtn.addEventListener('touchend', e => {
  e.preventDefault();
  e.stopPropagation();
  copyBtn.style.background = 'rgba(18,30,60,0.36)';
  copyBtn.click();
});
</script>
</body>
</html>
