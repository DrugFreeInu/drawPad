<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>DrawPad â€” Live</title>

<!-- Strict CSP to block cookies, network, and external scripts -->
<meta http-equiv="Content-Security-Policy"
      content="
        default-src 'self';
        script-src 'self';
        style-src 'self' 'unsafe-inline';
        img-src 'self' data:;
        connect-src 'none';
        frame-ancestors 'none';
        object-src 'none';
        form-action 'none';
        base-uri 'self';
      ">

<style>
  html, body {
    margin: 0;
    height: 100%;
    width: 100%;
    overflow: hidden;
    background: #000;
    font-family: system-ui;
    color: #8fbfff;
  }

  iframe { 
    position: fixed;
    inset: 0;
    width: 100%;
    height: 100%;
    border: 0;
    pointer-events: none; /* Let clicks pass through so button works */
  }

  #copyBtn {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 10px 14px;
    background: rgba(18,30,60,0.36);
    color: #8fbfff;
    font-weight: 700;
    border-radius: 20px;
    cursor: pointer;
    z-index: 9999;
    pointer-events: auto; /* Make button clickable */
    user-select: none;
    transition: background 0.15s ease;
  }

  #copyBtn:active {
    background: rgba(143,191,255,0.36); /* quick tap feedback */
  }
</style>
</head>
<body>

<iframe id="gridFrame" src="grid.html" style="z-index:0;"></iframe>
<iframe id="drawpadFrame" src="drawpad.html" style="z-index:1;"></iframe>
<div id="copyBtn" style="z-index:2;">Copy Code</div>

<script>
  // Anti-cookie enforcement
  Object.defineProperty(document, 'cookie', {
    get: () => "",
    set: () => { console.warn("Cookies blocked"); }
  });

  // Auto-cache the drawpad iframe
  const drawpad = document.getElementById('drawpadFrame');
  const timestamp = Date.now();
  drawpad.src = 'drawpad.html?v=' + timestamp;

  // Copy minimal JS code of points from drawpad.html
  const copyBtn = document.getElementById('copyBtn');
  copyBtn.addEventListener('click', async () => {
    // Ask the drawpad iframe for its points
    const points = await new Promise(resolve => {
      const handler = e => {
        if(e.data?.type === 'sendPoints') {
          resolve(e.data.points);
          window.removeEventListener('message', handler);
        }
      };
      window.addEventListener('message', handler);
      drawpad.contentWindow.postMessage({ type: 'getPoints' }, '*');
    });

    if(!points) return;
    const codeLines = points.map(p => `ctx.fillRect(${p.x},${p.y},4,4);`);
    const fullCode = `const canvas = document.getElementById('draw');\nconst ctx = canvas.getContext('2d');\n` + codeLines.join('\n');

    // Copy to clipboard
    try {
      await navigator.clipboard.writeText(fullCode);
      copyBtn.textContent = "Copied!";
    } catch {
      copyBtn.textContent = "Failed!";
    }

    setTimeout(() => copyBtn.textContent="Copy Code", 1000);
  });

  // Optional: tap feedback for touch devices
  copyBtn.addEventListener('touchstart', e => {
    e.preventDefault();
    copyBtn.click();
  });
</script>
</body>
</html>
