<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>DrawPad â€” Live</title>

<style>
  html, body {
    margin: 0;
    height: 100%;
    width: 100%;
    overflow: hidden;
    background: #000;
    font-family: system-ui;
    color: #8fbfff;
  }

  /* Iframes cover screen but don't block clicks */
  iframe { 
    position: fixed;
    inset: 0;
    width: 100%;
    height: 100%;
    border: 0;
    pointer-events: none; /* MUST be none so button can be tapped */
  }

  /* Button container on top */
  #buttonContainer {
    position: fixed;
    inset: 0;
    z-index: 9999;
    pointer-events: none; /* allow iframes to ignore clicks except button */
  }

  #copyBtn {
    position: absolute;
    top: 20px;
    right: 20px;
    padding: 10px 14px;
    background: rgba(18,30,60,0.36);
    color: #8fbfff;
    font-weight: 700;
    border-radius: 20px;
    cursor: pointer;
    pointer-events: auto; /* MUST be auto so button itself is clickable */
    user-select: none;
    transition: background 0.15s ease;
  }

  #copyBtn:active {
    background: rgba(143,191,255,0.36); /* tap feedback */
  }
</style>
</head>
<body>

<iframe id="gridFrame" src="grid.html" style="z-index:0;"></iframe>
<iframe id="drawpadFrame" src="drawpad.html" style="z-index:1;"></iframe>

<div id="buttonContainer">
  <div id="copyBtn">Copy Code</div>
</div>

<script>
const drawpad = document.getElementById('drawpadFrame');
drawpad.src = 'drawpad.html?v=' + Date.now();

const copyBtn = document.getElementById('copyBtn');
copyBtn.addEventListener('click', async () => {
  const points = await new Promise(resolve => {
    const handler = e => {
      if (e.data?.type === 'sendPoints') {
        resolve(e.data.points);
        window.removeEventListener('message', handler);
      }
    };
    window.addEventListener('message', handler);
    drawpad.contentWindow.postMessage({ type: 'getPoints' }, '*');
  });

  if (!points) return;
  const codeLines = points.map(p => `ctx.fillRect(${p.x},${p.y},4,4);`);
  const fullCode = `const canvas = document.getElementById('draw');\nconst ctx = canvas.getContext('2d');\n` + codeLines.join('\n');

  try {
    await navigator.clipboard.writeText(fullCode);
    copyBtn.textContent = "Copied!";
  } catch {
    copyBtn.textContent = "Failed!";
  }
  setTimeout(() => copyBtn.textContent = "Copy Code", 1000);
});

// Touch feedback
copyBtn.addEventListener('touchstart', e => {
  e.preventDefault();
  copyBtn.click();
});
</script>
</body>
</html>
