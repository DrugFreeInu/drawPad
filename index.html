<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>DrawPad â€” Live</title>

<!-- Strict CSP to block cookies, network, and external scripts -->
<meta http-equiv="Content-Security-Policy"
      content="
        default-src 'self';
        script-src 'self';
        style-src 'self' 'unsafe-inline';
        img-src 'self' data:;
        connect-src 'none';
        frame-ancestors 'none';
        object-src 'none';
        form-action 'none';
        base-uri 'self';
      ">

<style>
  html, body {
    margin: 0;
    height: 100%;
    width: 100%;
    overflow: hidden;
    background: #000;
    font-family: system-ui;
    color: #8fbfff;
  }

  iframe { 
    position: fixed;
    inset: 0;
    width: 100%;
    height: 100%;
    border: 0;
  }

  #copyBtn {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 10px 14px;
    background: rgba(18,30,60,0.36);
    color: #8fbfff;
    font-weight: 700;
    border-radius: 20px;
    cursor: pointer;
    z-index: 9999;
  }
</style>
</head>
<body>

<!-- Drawpad iframe -->
<iframe id="drawpadFrame" src="drawpad.html"></iframe>

<!-- Optional code iframe (hidden, not required for copy) -->
<iframe id="codeFrame" src="code.html" style="display:none;"></iframe>

<!-- Copy code button -->
<div id="copyBtn">Copy Code</div>

<script>
  // Anti-cookie enforcement
  Object.defineProperty(document, 'cookie', {
    get: () => "",
    set: () => { console.warn("Cookies blocked"); }
  });

  // Auto-cache the drawpad iframe
  const drawpad = document.getElementById('drawpadFrame');
  const timestamp = Date.now();
  drawpad.src = 'drawpad.html?v=' + timestamp;

  // Copy minimal JS code of points from drawpad.html
  const copyBtn = document.getElementById('copyBtn');
  copyBtn.addEventListener('click', async () => {
    // Ask the drawpad iframe for its points
    const points = await new Promise(resolve => {
      const handler = e => {
        if(e.data?.type === 'sendPoints') {
          resolve(e.data.points);
          window.removeEventListener('message', handler);
        }
      };
      window.addEventListener('message', handler);
      drawpad.contentWindow.postMessage({ type: 'getPoints' }, '*');
    });

    if(!points) return;
    const codeLines = points.map(p => `ctx.fillRect(${p.x},${p.y},4,4);`);
    const fullCode = `const canvas = document.getElementById('draw');\nconst ctx = canvas.getContext('2d');\n` + codeLines.join('\n');

    // Copy to clipboard
    navigator.clipboard.writeText(fullCode).then(() => {
      copyBtn.textContent = "Copied!";
      setTimeout(()=>copyBtn.textContent="Copy Code", 1000);
    });
  });
</script>
</body>
</html>
