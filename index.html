<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>DFCH Bridge â€” Local</title>

<!-- Strict CSP: local files only; no network; no eval; styles allowed inline for simplicity -->
<meta http-equiv="Content-Security-Policy"
  content="
    default-src 'self';
    script-src 'self';
    style-src 'unsafe-inline' 'self';
    img-src 'self' data:;
    connect-src 'none';
    frame-ancestors 'none';
    object-src 'none';
  ">

<style>
  /* minimal neutral UI (no external assets) */
  :root { --bg: #000; --glass: rgba(10,18,30,0.45); --accent: #8fbfff; }
  html,body { height:100%; width:100%; margin:0; background:var(--bg); overflow:hidden; font-family:system-ui, -apple-system, "Segoe UI", Roboto, Arial; color:#cfe6ff; }
  /* full-screen layers */
  iframe.layer {
    position:fixed;
    inset:0;
    width:100%;
    height:100%;
    border:0;
    background:transparent;
    pointer-events:none;
    transition:opacity .45s ease, z-index .2s;
  }
  /* drawpad starts hidden */
  #layer-drawpad { opacity:0; pointer-events:none; z-index:-1; }
  /* small UI for drawpad button if needed (but recommended to use drawpadbutton.html iframe) */
  .fallback-btn {
    position:fixed; right:18px; bottom:18px; z-index:9999; pointer-events:auto;
    background:var(--glass); padding:10px 14px; border-radius:20px; border:1px solid rgba(140,180,255,0.08);
    box-shadow:0 8px 30px rgba(0,0,0,0.6); color:var(--accent); font-weight:700; cursor:pointer;
  }
</style>
</head>
<body>

<!-- Layers loaded from local files only -->
<iframe id="layer-sky" class="layer" data-src="sky.html"></iframe>
<iframe id="layer-clouds" class="layer" data-src="clouds.html"></iframe>

<!-- Drawpad layer (hidden until open) -->
<iframe id="layer-drawpad" class="layer" data-src="drawpad.html" title="drawpad"></iframe>

<!-- Optional fallback button (local UI) -->
<button id="openFallback" class="fallback-btn" aria-label="Open Drawpad" style="display:none">Open Drawpad</button>

<script>
/* local-only loader: append timestamp to bypass aggressive caching while developing */
(function(){
  const v = Date.now();
  document.querySelectorAll('iframe[data-src]').forEach(f => {
    // ensure only local paths (defensive)
    const src = f.dataset.src || '';
    if (!src || src.includes('://')) {
      console.warn('Skipped loading unsafe src:', src);
      return;
    }
    f.src = src + '?v=' + v;
  });
})();

/* Listen for drawpad open message from drawpadbutton iframe or button */
(function(){
  const draw = document.getElementById('layer-drawpad');
  function openDrawpad() {
    draw.style.zIndex = 9999;
    draw.style.pointerEvents = 'auto';
    draw.style.opacity = 1;
    // focus inside drawpad if it wants messages
    // draw.contentWindow && draw.contentWindow.postMessage({type:'open'}, '*');
  }
  function closeDrawpad() {
    draw.style.opacity = 0;
    draw.style.pointerEvents = 'none';
    draw.style.zIndex = -1;
  }

  window.addEventListener('message', ev => {
    // only trust simple typed messages from iframes on same origin
    if (!ev.data || typeof ev.data.type !== 'string') return;
    if (ev.data.type === 'openDrawpad') openDrawpad();
    if (ev.data.type === 'closeDrawpad') closeDrawpad();
  }, false);

  // fallback local button (optional); useful if drawpadbutton not loaded
  const fallback = document.getElementById('openFallback');
  fallback.style.display = 'block';
  fallback.addEventListener('click', openDrawpad);
})();
</script>
</body>
</html>
