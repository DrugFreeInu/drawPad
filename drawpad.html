<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>DrawPad</title>

<style>
  html, body {
    margin: 0;
    height: 100%;
    overflow: hidden;
    background: #0b0b0b;
  }

  canvas {
    display: block;
    touch-action: none;
    cursor: crosshair;
  }
</style>
</head>
<body>

<canvas id="draw"></canvas>

<script>
const canvas = document.getElementById('draw');
const ctx = canvas.getContext('2d');

let drawing = false;
let path = [];
let points = [];

let startTime = 0;
const MAX_HOLD = 3000; // 3 seconds

/* Resize */
function resize() {
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
addEventListener('resize', resize);
resize();

/* Pastel base */
ctx.lineCap = 'round';
ctx.lineJoin = 'round';

function start(x, y) {
  drawing = true;
  startTime = performance.now();
  path = [{ x, y }];
  points.push({ x, y });
}

function move(x, y) {
  if (!drawing) return;
  path.push({ x, y });
  points.push({ x, y });
  redraw();
}

function end() {
  drawing = false;
  path = [];
}

function redraw() {
  const len = path.length;
  if (len < 2) return;

  const now = performance.now();
  const held = Math.min(now - startTime, MAX_HOLD);
  const t = held / MAX_HOLD; // 0 â†’ 1

  /* Density curve (ease-in) */
  const alpha = 0.08 + t * 0.35;
  const width = 18 + t * 18;
  const blur = 6 + t * 10;

  ctx.strokeStyle = `rgba(210,225,255,${alpha})`;
  ctx.lineWidth = width;
  ctx.shadowColor = `rgba(210,225,255,${alpha * 1.2})`;
  ctx.shadowBlur = blur;

  ctx.beginPath();
  ctx.moveTo(path[0].x, path[0].y);

  for (let i = 1; i < len - 1; i++) {
    const xc = (path[i].x + path[i + 1].x) / 2;
    const yc = (path[i].y + path[i + 1].y) / 2;
    ctx.quadraticCurveTo(path[i].x, path[i].y, xc, yc);
  }

  ctx.stroke();
  ctx.shadowBlur = 0;
}

/* Mouse */
canvas.addEventListener('mousedown', e => start(e.clientX, e.clientY));
canvas.addEventListener('mousemove', e => move(e.clientX, e.clientY));
canvas.addEventListener('mouseup', end);
canvas.addEventListener('mouseleave', end);

/* Touch */
canvas.addEventListener('touchstart', e => {
  const t = e.touches[0];
  start(t.clientX, t.clientY);
});
canvas.addEventListener('touchmove', e => {
  const t = e.touches[0];
  move(t.clientX, t.clientY);
});
canvas.addEventListener('touchend', end);

/* Export */
window.addEventListener('message', e => {
  if (e.data?.type === 'getPoints') {
    parent.postMessage({
      type: 'sendPoints',
      points
    }, '*');
  }
});
</script>

</body>
</html>
