<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>DrawPad</title>

<style>
  html, body {
    margin: 0;
    height: 100%;
    overflow: hidden;
    background: #0b0b0b;
  }

  canvas {
    display: block;
    touch-action: none;
    cursor: crosshair;
  }
</style>
</head>
<body>

<canvas id="draw"></canvas>

<script>
const canvas = document.getElementById('draw');
const ctx = canvas.getContext('2d');

let points = [];
let drawing = false;

// Resize
function resize() {
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
addEventListener('resize', resize);
resize();

/* --------- SMOOTH PASTEL SETTINGS --------- */
ctx.globalCompositeOperation = 'multiply';
ctx.lineCap = 'round';
ctx.lineJoin = 'round';

function drawPastel(x, y, last) {
  ctx.strokeStyle = 'rgba(200,220,255,0.07)';
  ctx.lineWidth = 22;

  ctx.beginPath();
  if (last) ctx.moveTo(last.x, last.y);
  ctx.lineTo(x, y);
  ctx.stroke();
}

/* --------- INPUT --------- */
function start(x, y) {
  drawing = true;
  points.push({ x, y });
}

function move(x, y) {
  if (!drawing) return;
  const last = points[points.length - 1];
  drawPastel(x, y, last);
  points.push({ x, y });
}

function end() {
  drawing = false;
}

/* Mouse */
canvas.addEventListener('mousedown', e => start(e.clientX, e.clientY));
canvas.addEventListener('mousemove', e => move(e.clientX, e.clientY));
canvas.addEventListener('mouseup', end);
canvas.addEventListener('mouseleave', end);

/* Touch */
canvas.addEventListener('touchstart', e => {
  const t = e.touches[0];
  start(t.clientX, t.clientY);
});
canvas.addEventListener('touchmove', e => {
  const t = e.touches[0];
  move(t.clientX, t.clientY);
});
canvas.addEventListener('touchend', end);

/* --------- EXPORT --------- */
window.addEventListener('message', e => {
  if (e.data?.type === 'getPoints') {
    parent.postMessage({
      type: 'sendPoints',
      points
    }, '*');
  }
});
</script>

</body>
</html>
